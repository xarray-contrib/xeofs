
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/1single/plot_eeof trend.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_1single_plot_eeof trend.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_1single_plot_eeof trend.py:


Removing nonlinear trends with EEOF analysis
============================================

This example demonstrates how to use Extended EOF (EEOF) analysis 
in order to remove nonlinear trends from a dataset.

Let's begin by setting up the required packages and fetching the data:

.. GENERATED FROM PYTHON SOURCE LINES 10-17

.. code-block:: default


    import xarray as xr
    import xeofs as xe
    import matplotlib.pyplot as plt

    xr.set_options(display_expand_data=False)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <xarray.core.options.set_options object at 0x7ff3615fb350>



.. GENERATED FROM PYTHON SOURCE LINES 18-19

Load the tutorial data.

.. GENERATED FROM PYTHON SOURCE LINES 19-24

.. code-block:: default


    sst = xr.tutorial.open_dataset("ersstv5").sst
    sst = sst.groupby("time.month") - sst.groupby("time.month").mean("time")









.. GENERATED FROM PYTHON SOURCE LINES 25-38

Prior to conducting the EEOF analysis, it's essential to determine the
structure of the lagged covariance matrix. This entails defining the time
delay ``tau`` and the ``embedding`` dimension. The former signifies the
interval between the original and lagged time series, while the latter
dictates the number of time-lagged copies in the delay-coordinate space,
representing the system's dynamics.
For illustration, using ``tau=4`` and ``embedding=40``, we generate 40
delayed versions of the time series, each offset by 4 time steps, resulting
in a maximum shift of ``tau x embedding = 160``. Given our dataset's
6-hour intervals, tau = 4 translates to a 24-hour shift.
It's obvious that this way of constructing the lagged covariance matrix
and subsequently decomposing it can be computationally expensive. For example,
given our dataset's dimensions,

.. GENERATED FROM PYTHON SOURCE LINES 38-44

.. code-block:: default


    eof = xe.models.EOF(n_modes=10)
    eof.fit(sst, dim="time")
    scores = eof.scores()
    components = eof.components()








.. GENERATED FROM PYTHON SOURCE LINES 45-51

.. code-block:: default


    fig, ax = plt.subplots(1, 2, figsize=(10, 5))
    scores.sel(mode=1).plot(ax=ax[0])
    components.sel(mode=1).plot(ax=ax[1])
    plt.show()




.. image-sg:: /auto_examples/1single/images/sphx_glr_plot_eeof trend_001.png
   :alt: mode = 1, mode = 1
   :srcset: /auto_examples/1single/images/sphx_glr_plot_eeof trend_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 52-53

EEOF analysis

.. GENERATED FROM PYTHON SOURCE LINES 53-59

.. code-block:: default


    eeof = xe.models.ExtendedEOF(n_modes=5, tau=1, embedding=120, n_pca_modes=50)
    eeof.fit(sst, dim="time")
    components_ext = eeof.components()
    scores_ext = eeof.scores()








.. GENERATED FROM PYTHON SOURCE LINES 60-66

.. code-block:: default


    fig, ax = plt.subplots(1, 2, figsize=(10, 5))
    scores_ext.sel(mode=1).plot(ax=ax[0])
    components_ext.sel(mode=1, embedding=0).plot(ax=ax[1])
    plt.show()




.. image-sg:: /auto_examples/1single/images/sphx_glr_plot_eeof trend_002.png
   :alt: mode = 1, embedding = 0, mode = 1
   :srcset: /auto_examples/1single/images/sphx_glr_plot_eeof trend_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 67-68

Remov the trend

.. GENERATED FROM PYTHON SOURCE LINES 68-73

.. code-block:: default


    sst_trends = eeof.inverse_transform(scores_ext.sel(mode=1))
    sst_detrended = sst - sst_trends.drop_vars("mode")









.. GENERATED FROM PYTHON SOURCE LINES 74-75

EOF analysis on detrended data

.. GENERATED FROM PYTHON SOURCE LINES 75-82

.. code-block:: default


    eof_model_detrended = xe.models.EOF(n_modes=5)
    eof_model_detrended.fit(sst_detrended, dim="time")
    scores_detrended = eof_model_detrended.scores()
    components_detrended = eof_model_detrended.components()









.. GENERATED FROM PYTHON SOURCE LINES 83-88

.. code-block:: default


    fig, ax = plt.subplots(1, 2, figsize=(10, 5))
    scores_detrended.sel(mode=1).plot(ax=ax[0])
    components_detrended.sel(mode=1, embedding=0).plot(ax=ax[1])
    plt.show()


.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "/home/nrieger/Projects/xeofs/examples/1single/plot_eeof trend.py", line 86, in <module>
        components_detrended.sel(mode=1, embedding=0).plot(ax=ax[1])
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/nrieger/miniconda3/envs/xeofs/lib/python3.11/site-packages/xarray/core/dataarray.py", line 1590, in sel
        ds = self._to_temp_dataset().sel(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/nrieger/miniconda3/envs/xeofs/lib/python3.11/site-packages/xarray/core/dataset.py", line 3047, in sel
        query_results = map_index_queries(
                        ^^^^^^^^^^^^^^^^^^
      File "/home/nrieger/miniconda3/envs/xeofs/lib/python3.11/site-packages/xarray/core/indexing.py", line 185, in map_index_queries
        grouped_indexers = group_indexers_by_index(obj, indexers, options)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/nrieger/miniconda3/envs/xeofs/lib/python3.11/site-packages/xarray/core/indexing.py", line 146, in group_indexers_by_index
        raise KeyError(
    KeyError: "'embedding' is not a valid dimension or coordinate for Dataset with dimensions Frozen({'lat': 89, 'lon': 180, 'mode': 5})"





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 23.776 seconds)


.. _sphx_glr_download_auto_examples_1single_plot_eeof trend.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_eeof trend.py <plot_eeof trend.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_eeof trend.ipynb <plot_eeof trend.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
